<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-coding-guides/bots">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">Bots | Maxbot Open Source Conversational AI Framework</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://maxbot-ai.maxbot.ai/coding-guides/bots"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Bots | Maxbot Open Source Conversational AI Framework"><meta data-rh="true" name="description" content="The bot consists of several different components. The bot builder allows you to customize these components before loading resources."><meta data-rh="true" property="og:description" content="The bot consists of several different components. The bot builder allows you to customize these components before loading resources."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://maxbot-ai.maxbot.ai/coding-guides/bots"><link data-rh="true" rel="alternate" href="https://maxbot-ai.maxbot.ai/coding-guides/bots" hreflang="en"><link data-rh="true" rel="alternate" href="https://maxbot-ai.maxbot.ai/coding-guides/bots" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0f77548b.css">
<link rel="preload" href="/assets/js/runtime~main.a7f9c446.js" as="script">
<link rel="preload" href="/assets/js/main.4414c277.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_black.svg" alt="Maxbot Open Source Conversational AI Framework" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_blue.svg" alt="Maxbot Open Source Conversational AI Framework" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/maxbot-ai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/intro">Intoduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/category/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/creating-bots">Creating Bots</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/design-guides">Design Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Design Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/design-reference">Design Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Design Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/category/coding-guides">Coding Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Coding Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coding-guides/basic-example">Basic Example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/coding-guides/bots">Bots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coding-guides/resources">Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coding-guides/channels">Channels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coding-guides/extensions">Extensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coding-guides/packaging">Packaging Guide</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/coding-guides"><span itemprop="name">Coding Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Bots</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Bots</h1><p>The bot consists of several different components. The bot builder allows you to customize these components before loading resources.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from maxbot import MaxBot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder = MaxBot.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># here you can customize your bot by changing builder properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.use_file_resources(&#x27;bot.yaml&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot = builder.build()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below are examples of customizing the bot.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sql-engine-for-state-tracker">SQL Engine for State Tracker<a href="#sql-engine-for-state-tracker" class="hash-link" aria-label="Direct link to SQL Engine for State Tracker" title="Direct link to SQL Engine for State Tracker">​</a></h2><p>MaxBot uses the <code>state_tracker</code> component to persist the state of the conversation. The default implementation is based on the <a href="https://www.sqlalchemy.org" target="_blank" rel="noopener noreferrer">sqlalchemy</a> library with the in-memory sqlite engine preconfigured. You can set your own sqlalchemy <a href="https://docs.sqlalchemy.org/en/14/core/engines.html" target="_blank" rel="noopener noreferrer">engine</a> by accessing the <code>engine</code> property.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from maxbot import MaxBot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder = MaxBot.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.state_tracker.engine = sqlalchemy.create_engine(...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot = builder.build()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that all tables needed to persist the state will be created immediately after you set the <code>engine</code> property.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="jinja-filters-tests-and-globals">Jinja Filters, Tests and Globals<a href="#jinja-filters-tests-and-globals" class="hash-link" aria-label="Direct link to Jinja Filters, Tests and Globals" title="Direct link to Jinja Filters, Tests and Globals">​</a></h2><p>MaxBot actively uses the <a href="https://jinja.palletsprojects.com" target="_blank" rel="noopener noreferrer">Jinja</a> template engine in its conversation scenarios. Jinja itself is highly customizable, so you can configure it directly through the <code>jinja_env</code> property of the <code>builder</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder.jinja_env.add_extension(...)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>builder</code> also provides convenience methods and decorators for adding filters, test and globals to the jinja environment.</p><p>Here is an example of adding and using a simple filter. The filter will reverse the incoming string.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from maxbot import MaxBot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder = MaxBot.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@builder.template_filter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def reverse(s):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return s[::-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.use_inline_resources(&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dialog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - condition: message.text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response: !jinja &quot;{{ message.text|reverse }}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot = builder.build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dialog = {&quot;channel_name&quot;: &quot;cli&quot;, &quot;user_id&quot;: 1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = {&quot;text&quot;: &quot;abcdef&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(bot.process_message(message, dialog))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># [{&#x27;text&#x27;: &#x27;fedcba&#x27;}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alternative ways to add such filter.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def reverse(s):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return s[::-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add a filter using a method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.add_template_filter(reverse, &#x27;reverse&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add a filter via direct access to jinja environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.jinja_env.filters[&#x27;reverse&#x27;] = reverse</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are similar methods to add globals and tests to the jinja environment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="receiving-custom-messages">Receiving Custom Messages<a href="#receiving-custom-messages" class="hash-link" aria-label="Direct link to Receiving Custom Messages" title="Direct link to Receiving Custom Messages">​</a></h2><p>Messages are what your bot receives from users. MaxBot supports most common message types by default, such as <code>text</code> or <code>image</code>. You can add any custom message type depending on your needs.</p><p>Each message type has a name and structure that are validated by marshmallow schema. To add a custom message, you need to declare its schema class and register its name and schema using the decorator <code>builder.message</code> or method <code>builder.add_message</code>. After that you are allowed to pass the message of specified structure to the <code>process_message</code> mehtod of the bot. You can access the message fields in your conversational scenarios via the <code>message</code> template variable.</p><p>See an example of creating <code>contact</code> message that allows user to pass some basic contact information to the bot, including their name and phone number.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from marshmallow import fields, Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from maxbot import MaxBot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder = MaxBot.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@builder.message(&quot;contact&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ContactMessage(Schema):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    phone = fields.String(required=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name = fields.String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.use_inline_resources(&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dialog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - condition: message.contact</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response: !jinja &quot;Received {{ message.contact.phone }}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot = builder.build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dialog = {&quot;channel_name&quot;: &quot;cli&quot;, &quot;user_id&quot;: 1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = {&quot;contact&quot;: {&quot;phone&quot;: &quot;1-541-754-3010&quot;}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(bot.process_message(message, dialog))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># [{&#x27;text&#x27;: &#x27;Received 1-541-754-3010&#x27;}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sending-custom-commands">Sending Custom Commands<a href="#sending-custom-commands" class="hash-link" aria-label="Direct link to Sending Custom Commands" title="Direct link to Sending Custom Commands">​</a></h2><p>Commands are what your bot sends to users. As for messages, MaxBot supports most common command types by default and you can add any custom command type.</p><p>Each command type has a name and structure that are validated by marshmallow schema. To add a custom command, you need to declare its schema class and register its name and schema using the decorator <code>builder.command</code> or method <code>builder.add_command</code>. After that you are allowed to use the command of specified structure in conversational scenarios and this command will be returned in the result of the <code>process_message</code> method of the bot.</p><p>Below is an example of adding the <code>location</code> command, which allows you to send an arbitrary point on the map to the user.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from marshmallow import fields, Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from maxbot import MaxBot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder = MaxBot.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@builder.command(&quot;location&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class LocationCommand(Schema):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    longitude = fields.Float(required=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    latitude = fields.Float(required=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.use_inline_resources(&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dialog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - condition: message.text == &quot;Where are you?&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - location: {latitude: 40.7580, longitude: -73.9855}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot = builder.build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dialog = {&quot;channel_name&quot;: &quot;cli&quot;, &quot;user_id&quot;: 1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = {&quot;text&quot;: &quot;Where are you?&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(bot.process_message(message, dialog))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># [{&#x27;location&#x27;: {&#x27;longitude&#x27;: -73.9855, &#x27;latitude&#x27;: 40.758}}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="extending-scenario-context">Extending scenario context<a href="#extending-scenario-context" class="hash-link" aria-label="Direct link to Extending scenario context" title="Direct link to Extending scenario context">​</a></h2><p>Scenario context contains the data needed to control the conversation logic. MaxBot provides a lot of data for the context, such as <code>message</code> received from user, <code>intents</code>, <code>entities</code> and more.</p><p>The following example shows how to extend the scenario context with a user profile taken from an external source.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from maxbot import MaxBot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder = MaxBot.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># this is a stub, actually you can load user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># profile from database or external api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def _load_profile(user_id):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;username&quot;: &quot;Yours Truly&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@builder.before_turn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def provide_profile(ctx):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx.extend_scenario_context(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        profile=_load_profile(ctx.dialog.user_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.use_inline_resources(&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dialog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - condition: profile.username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response: !jinja &#x27;Hello, {{ profile.username }}!&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot = builder.build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dialog = {&quot;channel_name&quot;: &quot;cli&quot;, &quot;user_id&quot;: 1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = {&quot;text&quot;: &quot;hello&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(bot.process_message(message, dialog))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[{&#x27;text&#x27;: &#x27;Hello, Yours Truly!&#x27;}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above example, we do the following.</p><ul><li>We register the <code>before_turn</code> hook. This hook is called at the beginning of processing each message received from the user.</li><li>We get the <code>ctx</code> object as the first argument to the hook. This object is an instance of the <code>TurnContext</code> class wich represents all information about the current turn of the  conversation.</li><li>We access <code>ctx.dialog.user_id</code> attribute of the context to get the user identifier. We then load the user profile from an external source using it.</li><li>We extend the scenario context with the loaded user profile using the <code>ctx.extend_scenario_context</code> method.</li><li>Finally, we successfuly use the <code>profile</code> template variable to get the <code>username</code> in our simple conversation scenario.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conversation-audit">Conversation audit<a href="#conversation-audit" class="hash-link" aria-label="Direct link to Conversation audit" title="Direct link to Conversation audit">​</a></h2><p>The result of processing the received message is the list of commands that need to be send to the user. During the processing commands are written to the <code>ctx.commands</code> attribute of the <code>TurnContext</code>.  You can access to these commands before sending using the <code>after_turn</code> hook.</p><p>In the example we show how to use <code>after_turn</code> hook to perform conversation audit. Using the <code>TurnContext</code> we access all the informatin about the current conversation turn. We simply print this information to stdout.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from maxbot import MaxBot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder = MaxBot.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@builder.after_turn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def journal_conversation(ctx, listening):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print ((</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        f&quot;Got {ctx.message}\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        f&quot;from {ctx.dialog}\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        f&quot;with response {ctx.commands}.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.use_inline_resources(&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dialog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - condition: message.text == &#x27;hello&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response: Good day to you!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot = builder.build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dialog = {&quot;channel_name&quot;: &quot;cli&quot;, &quot;user_id&quot;: 1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = {&quot;text&quot;: &quot;hello&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bot.process_message(message, dialog)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Got {&#x27;text&#x27;: &#x27;hello&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># from {&#x27;channel_name&#x27;: &#x27;cli&#x27;, &#x27;user_id&#x27;: 1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># with response [{&#x27;text&#x27;: &#x27;Good day to you!&#x27;}].</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/coding-guides/basic-example"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Basic Example</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/coding-guides/resources"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Resources</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sql-engine-for-state-tracker" class="table-of-contents__link toc-highlight">SQL Engine for State Tracker</a></li><li><a href="#jinja-filters-tests-and-globals" class="table-of-contents__link toc-highlight">Jinja Filters, Tests and Globals</a></li><li><a href="#receiving-custom-messages" class="table-of-contents__link toc-highlight">Receiving Custom Messages</a></li><li><a href="#sending-custom-commands" class="table-of-contents__link toc-highlight">Sending Custom Commands</a></li><li><a href="#extending-scenario-context" class="table-of-contents__link toc-highlight">Extending scenario context</a></li><li><a href="#conversation-audit" class="table-of-contents__link toc-highlight">Conversation audit</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Maxbot Team</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a7f9c446.js"></script>
<script src="/assets/js/main.4414c277.js"></script>
</body>
</html>