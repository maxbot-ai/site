"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[429],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var r=a.createContext({}),d=function(e){var t=a.useContext(r),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(r.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=d(n),m=o,c=u["".concat(r,".").concat(m)]||u[m]||h[m]||i;return n?a.createElement(c,s(s({ref:t},p),{},{components:n})):a.createElement(c,s({ref:t},p))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=m;var l={};for(var r in t)hasOwnProperty.call(t,r)&&(l[r]=t[r]);l.originalType=e,l[u]="string"==typeof e?e:o,s[1]=l;for(var d=2;d<i;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8244:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var a=n(7462),o=(n(7294),n(3905));const i={toc_min_heading_level:2,toc_max_heading_level:2},s="Making Reservation",l={unversionedId:"tutorials/reservation",id:"tutorials/reservation",title:"Making Reservation",description:"In this tutorial, you will add slots to a dialog node to collect multiple pieces of information from a user within a single node. The node you create will collect the information that is needed to make a restaurant reservation.",source:"@site/docs/tutorials/reservation.md",sourceDirName:"tutorials",slug:"/tutorials/reservation",permalink:"/tutorials/reservation",draft:!1,tags:[],version:"current",frontMatter:{toc_min_heading_level:2,toc_max_heading_level:2},sidebar:"docsSidebar",previous:{title:"Restaurant Bot",permalink:"/tutorials/restaurant"},next:{title:"Understanding Digressions",permalink:"/tutorials/digressions"}},r={},d=[{value:"Prerequisite",id:"prerequisite",level:2},{value:"Add a dialog node with slots",id:"add-a-dialog-node-with-slots",level:2},{value:"Add an intent",id:"add-an-intent",level:3},{value:"Add a dialog node",id:"add-a-dialog-node",level:3},{value:"Run and test",id:"run-and-test",level:3},{value:"Improve the format of the responses",id:"improve-the-format-of-the-responses",level:2},{value:"Validate user input",id:"validate-user-input",level:2},{value:"Enable datetime extension",id:"enable-datetime-extension",level:3},{value:"Ensure that the date is not in the past",id:"ensure-that-the-date-is-not-in-the-past",level:3},{value:"Check whether a time falls within the seating time window",id:"check-whether-a-time-falls-within-the-seating-time-window",level:3},{value:"Track the change in the number of guests",id:"track-the-change-in-the-number-of-guests",level:3},{value:"Add a confirmation slot",id:"add-a-confirmation-slot",level:2},{value:"Add intents",id:"add-intents",level:3},{value:"Add a slot",id:"add-a-slot",level:3},{value:"Add <code>found</code> response",id:"add-found-response",level:3},{value:"Add <code>not_found</code> response",id:"add-not_found-response",level:3},{value:"Prevent repetitive responses",id:"prevent-repetitive-responses",level:3},{value:"Give a way to exit the process",id:"give-a-way-to-exit-the-process",level:2},{value:"Add intent",id:"add-intent",level:3},{value:"Add slot handler",id:"add-slot-handler",level:3},{value:"Modify node-level response",id:"modify-node-level-response",level:3},{value:"Run and test",id:"run-and-test-1",level:3},{value:"Limit failed attempts",id:"limit-failed-attempts",level:2},{value:"Run and test",id:"run-and-test-2",level:3},{value:"Conclusion",id:"conclusion",level:2}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"making-reservation"},"Making Reservation"),(0,o.kt)("p",null,"In this tutorial, you will add slots to a dialog node to collect multiple pieces of information from a user within a single node. The node you create will collect the information that is needed to make a restaurant reservation."),(0,o.kt)("p",null,"By the time you finish the tutorial, you will understand how to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add slots to a dialog node."),(0,o.kt)("li",{parentName:"ul"},"Use rule-based entities that are needed by your dialog."),(0,o.kt)("li",{parentName:"ul"},"Add slot response conditions that address common user interactions."),(0,o.kt)("li",{parentName:"ul"},"Anticipate and address unrelated user input."),(0,o.kt)("li",{parentName:"ul"},"Handle unexpected user responses.")),(0,o.kt)("p",null,"The source code of the bot is available on github:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://bitbucket.int.midvix.ai/projects/COM/repos/maxbot/browse/examples/reservation-basic"},"reservation-basic")," - a simple node with slots that can capture the information necessary to make a reservation;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://bitbucket.int.midvix.ai/projects/COM/repos/maxbot/browse/examples/reservation"},"reservation")," - an advanced implementation, that improves the experience of users who interact with the node.")),(0,o.kt)("h2",{id:"prerequisite"},"Prerequisite"),(0,o.kt)("p",null,"Before you begin, complete the ",(0,o.kt)("a",{parentName:"p",href:"/getting-started/quick-start"},"Quick Start")," tutorial."),(0,o.kt)("p",null,"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"bot.yaml")," file that will contain the source code of the bot."),(0,o.kt)("p",null,"Add channel settings, for example, we use telegam channel:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"channels:\n  telegram:\n    api_token: 110201543:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw\n")),(0,o.kt)("h2",{id:"add-a-dialog-node-with-slots"},"Add a dialog node with slots"),(0,o.kt)("p",null,"In this section you created a node with slots that can capture the information necessary to reserve a table at a restaurant."),(0,o.kt)("h3",{id:"add-an-intent"},"Add an intent"),(0,o.kt)("p",null,"First of all, add an ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.reservation")," intent and examples that recognizes user input that indicates that the user wants to make a restaurant reservation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: reservation\n  examples:\n    - i'd like to make a reservation\n    - I want to reserve a table for dinner\n    - Can 3 of us get a table for lunch on May 29, 2022 at 5pm?\n    - do you have openings for next Wednesday at 7?\n    - Is there availability for 4 on Tuesday night?\n    - i'd like to come in for brunch tomorrow\n    - can i reserve a table?\n")),(0,o.kt)("h3",{id:"add-a-dialog-node"},"Add a dialog node"),(0,o.kt)("p",null,"The node you add will contain slots to collect the information required to make a reservation at a restaurant."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.reservation\n  label: reservation\n  slot_filling:\n    - name: date\n      check_for: entities.date\n      prompt: What day would you like to come in?\n    - name: time\n      check_for: entities.time\n      prompt: What time do you want the reservation to be made for?\n    - name: guests\n      check_for: entities.number\n      prompt: How many people will be dining?\n  response: !jinja >-\n      OK. I am making you a reservation for {{ slots.guests }}\n      on {{ slots.date }} at {{ slots.time }}.\n")),(0,o.kt)("p",null,"Each record in the slot filling block contains following fields."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name"),"- The name of the slot variable to be filled in, e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"slots.date"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"slots.time"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"slots.guests"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"check_for")," - An expression that checks if the user's input contains a piece of information of intrest. If so, the value of the expression is stored in the slot variable."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"prompt")," - A response that is used to request the value of a slot, it can be a string, a list of commands or a template.")),(0,o.kt)("p",null,"The node above uses rule-based entities to check the presence of the date ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.date"),", the time ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.time")," and the number of guests ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.number"),". The ",(0,o.kt)("inlineCode",{parentName:"p"},"check_for")," expression evaluates to captured entity values. These values are stored in the corresponding slots ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.date"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.time"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.guests"),". When all slots are filled, their values are substituted in the node's response."),(0,o.kt)("h3",{id:"run-and-test"},"Run and test"),(0,o.kt)("p",null,"Now you can run the bot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ maxbot run --bot bot.yaml\n\u2713 Started polling updater... Press 'Ctrl-C' to exit.\n")),(0,o.kt)("p",null,"Open your messenger and try to make a reservation."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type ",(0,o.kt)("inlineCode",{parentName:"p"},"i want to make a reservation"),". The bot recognizes the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.reservation")," intent, and it responds with the prompt for the first slot, ",(0,o.kt)("em",{parentName:"p"},'"What day would you like to come in?"'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type ",(0,o.kt)("inlineCode",{parentName:"p"},"on Friday"),". The bot recognizes the value, and uses it to fill the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.date")," variable for the first slot. It then shows the prompt for the next slot, ",(0,o.kt)("em",{parentName:"p"},'"What time do you want the reservation to be made for?"'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type ",(0,o.kt)("inlineCode",{parentName:"p"},"at 5pm"),". The bot recognizes the value, and uses it to fill the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.time")," variable for the second slot. It then shows the prompt for the next slot, ",(0,o.kt)("em",{parentName:"p"},'"How many people will be dining?"'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type ",(0,o.kt)("inlineCode",{parentName:"p"},"6"),". The bot recognizes the value, and uses it to fill the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.guests")," variable for the third slot. Now that all of the slots are filled, it shows the node response, ",(0,o.kt)("em",{parentName:"p"},'"OK. I am making you a reservation for 6 on 2022-05-29 at 17:00:00."')))),(0,o.kt)("p",null,"The beauty of slot filling is that the user is not required to provide all the information sequentially, as requested by the bot. For example, he can immediately provide all the information."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 Can 6 of us get a table for lunch tomorrow at 5pm?\n\ud83e\udd16 OK. I am making you a reservation for 6 on 2022-05-29 at 17:00:00.\n")),(0,o.kt)("p",null,"In next sections we improve the experience of users who interact with the node."),(0,o.kt)("h2",{id:"improve-the-format-of-the-responses"},"Improve the format of the responses"),(0,o.kt)("p",null,"When the values of ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.date")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.time")," are saved, they are converted into a standardized ISO format. This standardized format is useful for performing calculations on the values, but you might not want to expose this reformatting to users. In this step, you will reformat the date (",(0,o.kt)("inlineCode",{parentName:"p"},"2023-01-27"),") and time (",(0,o.kt)("inlineCode",{parentName:"p"},"17:00:00"),") values that are referenced by the dialog."),(0,o.kt)("p",null,"First of all, enable the format extension:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"extensions:\n  format: { locale: en }\n")),(0,o.kt)("p",null,"This will allow you to use the following template filters for variables."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'x|format_date("EEEE, MMMM d")')," - It converts the ",(0,o.kt)("inlineCode",{parentName:"li"},"2023-01-27")," value into a full day of the week, followed by the full month and day. The EEEE indicates that you want to spell out the day of the week. If you use 3 Es (EEE), the day of the week will be shortened to Fri instead of Friday, for example. The MMMM indicates that you want to spell out the month. Again, if you use only 3 Ms (MMM), the month is shortened to Dec instead of December."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'x|format_time("h:mm a")')," - It converts the ",(0,o.kt)("inlineCode",{parentName:"li"},"17:00:00")," value into the hour, minutes and indicates AM or PM.")),(0,o.kt)("p",null,"Edit the node's response as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-django"},'# ...\nresponse: !jinja >-\n    OK. I am making you a reservation for {{ slots.guests }} on\n    {{ slots.date|format_date("EEEE, MMMM d") }} at\n    {{ slots.time|format_time("h:mm a") }}.\n')),(0,o.kt)("p",null,"Test the node again."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 Can 6 of us get a table for lunch tomorrow at 5pm?\n\ud83e\udd16 OK. I am making you a reservation for 6 on Friday, January 27 at 5:00 PM.\n")),(0,o.kt)("p",null,"You have successfully improved the format that the dialog uses when it references variable values in its responses. The dialog now uses ",(0,o.kt)("inlineCode",{parentName:"p"},"Friday, January 27")," instead of the more technical, ",(0,o.kt)("inlineCode",{parentName:"p"},"2023-01-27"),". And it uses ",(0,o.kt)("inlineCode",{parentName:"p"},"5:00 PM")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"17:00:00"),"."),(0,o.kt)("h2",{id:"validate-user-input"},"Validate user input"),(0,o.kt)("p",null,"So far, we have assumed that the user will provide the appropriate value types for the slots. That is not always the case in reality. You can account for times when users might provide an invalid value by adding ",(0,o.kt)("inlineCode",{parentName:"p"},"found")," responses to slots. In this section, you will use conditional slot responses to perform the following tasks."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Valudate the user's input."),(0,o.kt)("li",{parentName:"ul"},"Confirm the user's input."),(0,o.kt)("li",{parentName:"ul"},"Indicate that you are replacing one value with another.")),(0,o.kt)("h3",{id:"enable-datetime-extension"},"Enable datetime extension"),(0,o.kt)("p",null,"You need to enable datetime extension to validate dates."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"extensions:\n  format: { locale: en }\n# highlight-next-line\n  datetime: {}\n")),(0,o.kt)("p",null,"This extension allows you to use the following template globals and filters for variables."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"now")," - The current value of the date and time."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x|date")," - It converts value to the date object."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"x|time")," - It converts value to the time object.")),(0,o.kt)("p",null,"The date and time objects can be compared using standard comparison operators ",(0,o.kt)("inlineCode",{parentName:"p"},">"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"<")," and so on."),(0,o.kt)("h3",{id:"ensure-that-the-date-is-not-in-the-past"},"Ensure that the date is not in the past"),(0,o.kt)("p",null,"Add the ",(0,o.kt)("inlineCode",{parentName:"p"},"found")," response for the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.date")," slot. Use the following if-condition to check whether the date that the user specifies falls before today."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: date\n  check_for: entities.date\n  prompt: What day would you like to come in?\n# highlight-start\n  found: !jinja/yaml |-\n      {% if slots.date|date < now|date %}\n        - text: You cannot make a reservation for a day in the past.\n        - prompt_again: {}\n      {% else %}\n        - text: >-\n            {{ slots.date|format_date("EEEE, MMMM d") }} it is.\n      {% endif %}\n# highlight-end\n')),(0,o.kt)("p",null,"If date is in the past, the bot uses ",(0,o.kt)("inlineCode",{parentName:"p"},"promt_again")," command to clear the value of the  slot and prompt it again. The else-clause is executed if the user provides a valid date. It displays a simple confirmation lets the user know that her response was understood."),(0,o.kt)("h3",{id:"check-whether-a-time-falls-within-the-seating-time-window"},"Check whether a time falls within the seating time window"),(0,o.kt)("p",null,"Add the ",(0,o.kt)("inlineCode",{parentName:"p"},"found")," response for the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.time")," slot. Use the following if-conditions  to check whether the time that the user specifies falls within the allowed time window."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: time\n  check_for: entities.time\n  prompt: What time do you want the reservation to be made for?\n# highlight-start\n  found: !jinja/yaml |-\n      {% if slots.time|time > "21:00:00"|time %}\n        - text: Our last seating is at 9 PM.\n        - prompt_again: {}\n      {% elif slots.time|time < "09:00:00"|time %}\n        - text: Our first seating is at 9 AM.\n        - prompt_again: {}\n      {% else %}\n        - text: >-\n            Ok, the reservation is for {{ slots.time|format_time("h:mm a") }}.\n      {% endif %}\n# highlight-end\n')),(0,o.kt)("p",null,"If time is invalid, the bot uses ",(0,o.kt)("inlineCode",{parentName:"p"},"promt_again")," command to clear the value of the  slot and prompt it again. The else-clause is executed if the user provides a valid time. It displays a simple confirmation lets the user know that her response was understood."),(0,o.kt)("h3",{id:"track-the-change-in-the-number-of-guests"},"Track the change in the number of guests"),(0,o.kt)("p",null,"Edit the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.guests")," slot to validate the value provided by the user in the following ways."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Check that the number of guests specified is larger than zero."),(0,o.kt)("li",{parentName:"ul"},"Anticipate and address the case when the user changes the number of guests.")),(0,o.kt)("p",null,"If, at any point while the node with slots is being processed, the user changes a slot value, the corresponding slot variable value is updated. However, it can be useful to let the user know that the value is being replaced, both to give clear feedback to the user and to give the user a chance to rectify it if the change was not what she intended."),(0,o.kt)("p",null,"Track the change in the number of guests using the special variables available in the found response: ",(0,o.kt)("inlineCode",{parentName:"p"},"previous_value")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"current_value"),". These variables contain the previous and current value of the slot being filled."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: guests\n  check_for: entities.number\n  prompt: How many people will be dining?\n  found: !jinja/yaml |-\n      {% if slots.guests < 1 %}\n          - text: Please specify a number that is larger than 0.\n          - prompt_again: {}\n      {% elif previous_value and previous_value != current_value %}\n          - text: >-\n              Ok, updating the number of guests from {{ previous_value }}\n              to {{ current_value }}.\n      {% else %}\n          - text: >-\n              Ok. The reservation is for {{ slots.guests }} guests.\n      {% endif %}\n")),(0,o.kt)("h2",{id:"add-a-confirmation-slot"},"Add a confirmation slot"),(0,o.kt)("p",null,"You might want to design your dialog to call an external reservation system and actually book a reservation for the user in the system. Before your application takes this action, you probably want to confirm with the user that the dialog has understood the details of the reservation correctly. You can do so by adding a confirmation slot to the node."),(0,o.kt)("h3",{id:"add-intents"},"Add intents"),(0,o.kt)("p",null,"The confirmation slot will expect a Yes or No answer from the user. You must teach the dialog to be able to recognize a Yes or No intent in the user input first."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'  - name: "yes"\n    examples:\n      - "Yes"\n      - Sure\n      - I\'d like that\n      - Please do.\n      - Yes please.\n      - Ok\n      - That sounds good.\n  - name: "no"\n    examples:\n      - "No"\n      - No thanks.\n      - Please don\'t.\n      - Please do not!\n      - That\'s not what I want at all\n      - Absolutely not.\n      - No way\n')),(0,o.kt)("h3",{id:"add-a-slot"},"Add a slot"),(0,o.kt)("p",null,"Add the following slot to the dialog node. This slot must be the last slot in the node's list of slots."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: confirmation\n  check_for: slot_in_focus and (intents.yes or intents.no)\n  prompt: !jinja >-\n      I\'m going to reserve you a table for {{ slots.guests }} on\n      {{ slots.date|format_date("EEEE, MMMM d") }} at\n      {{ slots.time|format_time("h:mm a") }}. Should I go ahead?\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"check_for")," condition checks for either answer. You will specify what happens next depending on whether the user answer Yes or No by using if-condition in ",(0,o.kt)("inlineCode",{parentName:"p"},"found")," response."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"slot_in_focus")," property forces the scope of this condition to apply to the current slot only. This setting prevents random statements that could match against ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.yes")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.no")," that the user might make from triggering this slot."),(0,o.kt)("p",null,"For example, the user might be answering the number of guests slot, and say something like, ",(0,o.kt)("em",{parentName:"p"},'"Yes, there will be 5 of us"'),". You do not want the ",(0,o.kt)("em",{parentName:"p"},'"Yes"')," included in this response to accidentally fill the confirmation slot. By adding the ",(0,o.kt)("inlineCode",{parentName:"p"},"slot_in_focus")," property to the condition, a yes or no indicated by the user is applied to this slot only when the user is answering the prompt for this slot specifically."),(0,o.kt)("h3",{id:"add-found-response"},"Add ",(0,o.kt)("inlineCode",{parentName:"h3"},"found")," response"),(0,o.kt)("p",null,"Add the found response with if-condition that checks for a No response (",(0,o.kt)("inlineCode",{parentName:"p"},"intents.no"),"). In this case, start requesting slots again. Otherwise, you can assume the user confirmed the reservation details and proceed with making the reservation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# ...\nfound: !jinja/yaml |-\n    {% if intents.no %}\n        - text: Alright. Let's start over. I'll try to keep up this time.\n        {% slot date = none %}\n        {% slot time = none %}\n        {% slot guests = none %}\n        {% slot confirmation = none %}\n    {% endif %}\n")),(0,o.kt)("p",null,"In order for the bot to start requesting slots, you need to reset their current values. Do this by setting the slot variables to ",(0,o.kt)("inlineCode",{parentName:"p"},"none"),"."),(0,o.kt)("h3",{id:"add-not_found-response"},"Add ",(0,o.kt)("inlineCode",{parentName:"h3"},"not_found")," response"),(0,o.kt)("p",null,"In the ",(0,o.kt)("inlineCode",{parentName:"p"},"not_found")," response, clarify that you are expecting the user to provide a Yes or No answer. Add a response with the following values."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# ...\nnot_found: >-\n    Respond with Yes to indicate that you want the reservation to be made\n    as-is, or No to indicate that you do not.\n")),(0,o.kt)("h3",{id:"prevent-repetitive-responses"},"Prevent repetitive responses"),(0,o.kt)("p",null,"Now that you have confirmation responses for slot values, and you ask for everything at once, you might notice that the individual slot responses are displayed before the confirmation slot response is displayed, which can appear repetitive to users. For example,"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 Can 6 of us get a table for lunch on May 29, 2023 at 5pm?\n\ud83e\udd16 Monday, May 29 it is.\n\ud83e\udd16 Ok, the reservation is for 5:00 PM.\n\ud83e\udd16 Ok. The reservation is for 6 guests.\n\ud83e\udd16 I'm going to reserve you a table for 6 on Monday, May 29 at 5:00 PM. Should I go ahead?\n")),(0,o.kt)("p",null,"Edit the slot found responses to prevent them from being displayed under certain conditions. Replace the else-clause that is specified in the ",(0,o.kt)("inlineCode",{parentName:"p"},"found")," responses with the following ones:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: date\n  check_for: entities.date\n  prompt: What day would you like to come in?\n  found: !jinja/yaml |-\n      {% if slots.date|date < now|date %}\n        - text: You cannot make a reservation for a day in the past.\n        - prompt_again: {}\n# highlight-next-line\n      {% elif not entities.time and not entities.number %}\n        - text: >-\n            {{ slots.date|format_date("EEEE, MMMM d") }} it is.\n      {% endif %}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: time\n  check_for: entities.time\n  prompt: What time do you want the reservation to be made for?\n  found: !jinja/yaml |-\n      {% if slots.time|time > "21:00:00"|time %}\n        - text: Our last seating is at 9 PM.\n        - prompt_again: {}\n      {% elif slots.time|time < "09:00:00"|time %}\n        - text: Our first seating is at 9 AM.\n        - prompt_again: {}\n# highlight-next-line\n      {% elif not entities.date and not entities.number %}\n        - text: >-\n            Ok, the reservation is for {{ slots.time|format_time("h:mm a") }}.\n      {% endif %}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: guests\n  check_for: entities.number\n  prompt: How many people will be dining?\n  found: !jinja/yaml |-\n      {% if slots.guests < 1 %}\n          - text: Please specify a number that is larger than 0.\n          - prompt_again: {}\n      {% elif previous_value and previous_value != current_value %}\n          - text: >-\n              Ok, updating the number of guests from {{ previous_value }}\n              to {{ current_value }}.\n# highlight-next-line\n      {% elif not entities.date and not entities.time %}\n          - text: >-\n              Ok. The reservation is for {{ slots.guests }} guests.\n      {% endif %}\n")),(0,o.kt)("p",null,"This prevent repetitive responses:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 Can 6 of us get a table for lunch on May 29, 2023 at 5pm?\n\ud83e\udd16 I'm going to reserve you a table for 6 on Monday, May 29 at 5:00 PM. Should I go ahead?\n")),(0,o.kt)("p",null,"If you add more slots later, you must edit these conditions to account for the associated context variables for the additional slots."),(0,o.kt)("h2",{id:"give-a-way-to-exit-the-process"},"Give a way to exit the process"),(0,o.kt)("p",null,"Adding a node with slots is powerful because it keeps users on track with providing the information you need to give them a meaningful response or perform an action on their behalf. However, there might be times when a user is in the middle of providing reservation details, but decides to not go through with placing the reservation. You must give users a way to exit the process gracefully. You can do so by adding a slot handler that can detect a user's desire to exit the process, and exit the node without saving any values that were collected."),(0,o.kt)("h3",{id:"add-intent"},"Add intent"),(0,o.kt)("p",null,"You must teach the dialog to be able to recognize an ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.exit")," intent in the user input first. Add the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.exit")," intent with the following example utterances."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"  - name: exit\n    examples:\n      - I want to stop\n      - Exit!\n      - Cancel this process\n      - I changed my mind. I don't want to make a reservation.\n      - Stop the reservation\n      - Wait, cancel this.\n      - Nevermind.\n")),(0,o.kt)("h3",{id:"add-slot-handler"},"Add slot handler"),(0,o.kt)("p",null,"Add the following slot handler to the node. The ",(0,o.kt)("inlineCode",{parentName:"p"},"response")," command jumps directly to the node-level response without displaying the prompts associated with any of the remaining unfilled slots."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.reservation\n  label: reservation\n  slot_filling:\n      # ...\n# highlight-start\n  slot_handlers:\n    - condition: intents.exit\n      response:\n        - text: Ok, we'll stop there. No reservation will be made.\n        - response: {}\n# highlight-end\n  response: !jinja >-\n      OK. I am making you a reservation for {{ slots.guests }}\n      on {{ slots.date }} at {{ slots.time }}.\n")),(0,o.kt)("h3",{id:"modify-node-level-response"},"Modify node-level response"),(0,o.kt)("p",null,"Now, you need to edit the node-level response to make it recognize when a user wants to exit the process rather than make a reservation. Add an if-condition for the response."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- condition: intents.reservation\n  label: reservation\n  slot_filling:\n      # ...\n  slot_handlers:\n    - condition: intents.exit\n      response:\n        - text: Ok, we\'ll stop there. No reservation will be made.\n        - response: {}\n# highlight-start\n  response: !jinja/yaml |-\n      {% if slots.confirmation %}\n        - text: >-\n            OK. I am making you a reservation for {{ slots.guests }} on\n            {{ slots.date|format_date("EEEE, MMMM d") }} at\n            {{ slots.time|format_time("h:mm a") }}.\n      {% else %}\n        - text: >-\n            I look forward to helping you with your next reservation.\n            Have a good day.\n      {% endif %}\n# highlight-end\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.confirmation")," condition is set to true when the user has filled in all the slots and confirmed them. The ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.exit")," handler skips all remaining slots to go directly to the node response. So, when the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.confirmation")," slot is not filled, you know the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.exit")," intent was triggered, and the dialog can display an alternate response."),(0,o.kt)("h3",{id:"run-and-test-1"},"Run and test"),(0,o.kt)("p",null,"Test this change by using the following script."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 i'd like to make a reservation.\n\ud83e\udd16 What day would you like to come in?\n\ud83e\uddd1 Nevermind\n\ud83e\udd16 Ok, we'll stop there. No reservation will be made.\n\ud83e\udd16 I look forward to helping you with your next reservation. Have a good day.\n")),(0,o.kt)("h2",{id:"limit-failed-attempts"},"Limit failed attempts"),(0,o.kt)("p",null,"In some cases, a user might not understand what you are asking for. They might respond again and again with the wrong types of values. To plan for this possibility, you can add a counter to the slot, and after 3 failed attempts by the user to provide a valid value, you can apply a value to the slot on the user's behalf and move on."),(0,o.kt)("p",null,"For the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.time")," information, you will define a follow-up statement that is displayed when the user does not provide a valid time. You will need one more slot variable ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.count")," that can keep track of how many times the user provides a value that does not match the value type that the slot expects. You want the slot variable to be initialized and set to 0 the first time it is processed, so you will use it with the ",(0,o.kt)("inlineCode",{parentName:"p"},"x|default")," filter."),(0,o.kt)("p",null,"Add the following ",(0,o.kt)("inlineCode",{parentName:"p"},"not_found")," response to the ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.time")," slot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: time\n  check_for: entities.time\n  prompt: What time do you want the reservation to be made for?\n  found: !jinja/yaml |-\n      {% if slots.time|time > "21:00:00"|time %}\n        - text: Our last seating is at 9 PM.\n        - prompt_again: {}\n      {% elif slots.time|time < "09:00:00"|time %}\n        - text: Our first seating is at 9 AM.\n        - prompt_again: {}\n      {% elif not entities.date and not entities.number %}\n        - text: >-\n            Ok, the reservation is for {{ slots.time|format_time("h:mm a") }}.\n      {% endif %}\n# highlight-start\n  not_found: !jinja/yaml |-\n      {% if slots.counter|default(0) > 1 %}\n          {% slot time = \'20:00\' %}\n          - text: >-\n              You seem to be having trouble choosing a time.\n              I will make the reservation at 8PM for you.\n      {% else %}\n          {% slot counter = slots.counter|default(0) + 1 %}\n          - text: >-\n              Please specify the time that you want to eat.\n              The restaurant seats people between 9AM and 9PM.\n      {% endif %}\n# highlight-end\n')),(0,o.kt)("p",null,"Remember, the ",(0,o.kt)("inlineCode",{parentName:"p"},"not_found")," response is only triggered when the user does not provide a valid ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.time")," value. An if-condition checks the number of attempts: 0, 1 and more. When it exceeds, the bot assigns the time value on the user's behalf to the popular dinner reservation time of 8 PM. Don't worry; the user will have a chance to change the time value when the confirmation slot is triggered. The counter value is incremented whenever the user enters an invalid ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.time")," value."),(0,o.kt)("h3",{id:"run-and-test-2"},"Run and test"),(0,o.kt)("p",null,"Test your changes by using the following script."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 i'd like to make a reservation on May 29, 2022\n\ud83e\udd16 2022-05-29 it is.\n\ud83e\udd16 What time do you want the reservation to be made for?\n\ud83e\uddd1 orange\n\ud83e\udd16 Please specify the time that you want to eat. The restaurant seats people between 9AM and 9PM.\n\ud83e\uddd1 pink\n\ud83e\udd16 Please specify the time that you want to eat. The restaurant seats people between 9AM and 9PM.\n\ud83e\uddd1 purple\n\ud83e\udd16 You seem to be having trouble choosing a time. I will make the reservation at 8PM for you.\n\ud83e\udd16 How many people will be dining?\n")),(0,o.kt)("h2",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"In this tutorial you tested a node with slots and made changes that optimize how it interacts with real users. For more information about this subject, see ",(0,o.kt)("a",{parentName:"p",href:"/design-guides/slot-filling"},"Slot Filling")," guide."))}u.isMDXComponent=!0}}]);