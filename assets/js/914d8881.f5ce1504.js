"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[46],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>g});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function m(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),s=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=s(e.components);return n.createElement(o.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,p=m(e,["components","mdxType","originalType","parentName"]),d=s(a),u=r,g=d["".concat(o,".").concat(u)]||d[u]||c[u]||l;return a?n.createElement(g,i(i({ref:t},p),{},{components:a})):n.createElement(g,i({ref:t},p))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=u;var m={};for(var o in t)hasOwnProperty.call(t,o)&&(m[o]=t[o]);m.originalType=e,m[d]="string"==typeof e?e:r,i[1]=m;for(var s=2;s<l;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},281:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>m,toc:()=>s});var n=a(7462),r=(a(7294),a(3905));const l={},i="Protocol",m={unversionedId:"design-reference/protocol",id:"design-reference/protocol",title:"Protocol",description:"All communication with the users takes place under a single platform-independent protocol.",source:"@site/docs/design-reference/protocol.md",sourceDirName:"design-reference",slug:"/design-reference/protocol",permalink:"/design-reference/protocol",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Resources",permalink:"/design-reference/resources"},next:{title:"Context",permalink:"/design-reference/context"}},o={},s=[{value:"Envelopes",id:"envelopes",level:2},{value:"<code>DialogSchema</code>",id:"dialogschema",level:3},{value:"<code>MessageSchema</code>",id:"messageschema",level:3},{value:"Attributes",id:"attributes",level:4},{value:"Examples",id:"examples",level:4},{value:"<code>CommandSchema</code>",id:"commandschema",level:3},{value:"Attributes",id:"attributes-1",level:4},{value:"Examples",id:"examples-1",level:4},{value:"Messages",id:"messages",level:2},{value:"<code>ImageMessage</code>",id:"imagemessage",level:3},{value:"Attributes",id:"attributes-2",level:4},{value:"Examples",id:"examples-2",level:4},{value:"Commands",id:"commands",level:2},{value:"<code>ImageCommand</code>",id:"imagecommand",level:3},{value:"Attributes",id:"attributes-3",level:4},{value:"Examples",id:"examples-3",level:4}],p={toc:s};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"protocol"},"Protocol"),(0,r.kt)("p",null,"All communication with the users takes place under a single platform-independent protocol."),(0,r.kt)("h2",{id:"envelopes"},"Envelopes"),(0,r.kt)("h3",{id:"dialogschema"},(0,r.kt)("inlineCode",{parentName:"h3"},"DialogSchema")),(0,r.kt)("p",null,"General information about the current conversation. Includes information that does not change or rarely changes during a conversation."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"channel_name")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the channel in which the conversation is taking place.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"user_id")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"The ID of the user with whom the conversation is taking place. This ID is unique within the channel.")))),(0,r.kt)("h3",{id:"messageschema"},(0,r.kt)("inlineCode",{parentName:"h3"},"MessageSchema")),(0,r.kt)("p",null,"Message received by the user."),(0,r.kt)("p",null,"This schema is implemented as an envelope for a different message types. The schema field represents a message of particular type. The field name is the name of the message type. The field type is the payload for the message of that type. Typically, only one field is populated for the message."),(0,r.kt)("p",null,"The schema supports most widely used message types in a platform-independent way. You can customize the schema by adding new types and overriding existing types."),(0,r.kt)("h4",{id:"attributes"},"Attributes"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"text")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"Text message.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"image")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#imagemessage"},"ImageMessage")),(0,r.kt)("td",{parentName:"tr",align:null},"Image message.")))),(0,r.kt)("h4",{id:"examples"},"Examples"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check for text message in dialog tree."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'condition: message.text == "Hello world!"\n# ...\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check whether you receive an image message using ",(0,r.kt)("inlineCode",{parentName:"p"},"message.image")," expression."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"condition: message.image\n# ...\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"You can capture the exact text uttered by the user using the ",(0,r.kt)("inlineCode",{parentName:"p"},"message.text")," expression. For example, the node checks for a text message in its condition, stores the text in the state variable for the future use and repeats the text that the user specified back in the response."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# ...\nresponse: You can leave a comment to the order.\nfollowup:\n  - condition: message.text\n    response: !jinja/yaml |-\n        {% slot order_comment = message.text %}\n        - text: Got it! Your comment: {{ message.text }}.\n")),(0,r.kt)("p",{parentName:"li"},"The dialog could be like this."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"...\n\ud83e\udd16 You can leave a comment to the order.\n\ud83e\uddd1 Please add extra cheese.\n\ud83e\udd16 Got it! Your comment: Please add extra cheese.\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To store the value of a string that you extract from the user's input, you can include a Jinja expression that uses the extract filter to apply a regular expression to the user input. The following expression extracts a number from the user input, and saves it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"slots.number")," variable."),(0,r.kt)("p",{parentName:"li"},"TODO: implement this"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'{% slot number = message.text|extract("\\d+", 0) %}\n')),(0,r.kt)("p",{parentName:"li"},"TODO: Using regexp ",(0,r.kt)("inlineCode",{parentName:"p"},"message.text|match(...)")))),(0,r.kt)("h3",{id:"commandschema"},(0,r.kt)("inlineCode",{parentName:"h3"},"CommandSchema")),(0,r.kt)("p",null,"Command to send to user."),(0,r.kt)("p",null,"This schema is implemented as an envelope for a different command types. The schema field represents a command of particular type. The field name is the name of the command type. The field type is the payload for the command of that type. Typically, only one field is populated for the command and commands are loaded in whole lists."),(0,r.kt)("p",null,"The schema supports most widely used command types in a platform-independent way. You can customize the schema by adding new types and overriding existing types."),(0,r.kt)("h4",{id:"attributes-1"},"Attributes"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"text")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"Text command.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"image")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#imagecommand"},"ImageCommand")),(0,r.kt)("td",{parentName:"tr",align:null},"Image command.")))),(0,r.kt)("h4",{id:"examples-1"},"Examples"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Mixed text and image commands."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"response:\n  - text: Hello world!\n  - image:\n      url: http://example.com/hello.png\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Send text command."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"response:\n  - text: Hello world!\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Use short syntax single text command instead of command list."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"response: Hello world!\n")))),(0,r.kt)("h2",{id:"messages"},"Messages"),(0,r.kt)("h3",{id:"imagemessage"},(0,r.kt)("inlineCode",{parentName:"h3"},"ImageMessage")),(0,r.kt)("p",null,"An image message payload."),(0,r.kt)("h4",{id:"attributes-2"},"Attributes"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"url"),"*"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"Image URL. Use this URL to download the image file. Download it ASAP because many messaging platforms do not guarantee the lifetime of the URL.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"size")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/numbers"},"Integer")),(0,r.kt)("td",{parentName:"tr",align:null},"Image size in bytes.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"caption")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"Caption as defined by the user.")))),(0,r.kt)("h4",{id:"examples-2"},"Examples"),(0,r.kt)("p",null,"The following node checks for an image message in its condition and responds with the image URL and caption."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: message.image\n  response: !jinja >-\n    Received image {{ message.image.url }}\n    with a caption {{ message.image.caption }}.\n")),(0,r.kt)("p",null,"The MaxBot CLI application outputs the dialog turn like the following."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"\ud83e\uddd1 image:\n     caption: hello image\n     size: 4097\n     url: https://api.telegram.org/file/bot123:XXXX/photos/file_10.jpg\n\ud83e\udd16 Received image https://api.telegram.org/file/bot123:XXXX/photos/file_13.jpg with a caption hello.\n")),(0,r.kt)("h2",{id:"commands"},"Commands"),(0,r.kt)("h3",{id:"imagecommand"},(0,r.kt)("inlineCode",{parentName:"h3"},"ImageCommand")),(0,r.kt)("p",null,"An image command payload."),(0,r.kt)("h4",{id:"attributes-3"},"Attributes"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"url"),"*"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"HTTP URL to get a file from the Internet.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"caption")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/design-reference/strings"},"String")),(0,r.kt)("td",{parentName:"tr",align:null},"Caption of the image to be sent.")))),(0,r.kt)("h4",{id:"examples-3"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"response:\n  - image:\n      url: http://example.com/hello.png\n      caption: Hello world!\n")))}d.isMDXComponent=!0}}]);