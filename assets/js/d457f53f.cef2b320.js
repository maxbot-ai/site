"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[168],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),h=u(n),c=o,m=h["".concat(l,".").concat(c)]||h[c]||p[c]||r;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[h]="string"==typeof e?e:o,s[1]=i;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4648:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>u});var a=n(7462),o=(n(7294),n(3905));const r={toc_min_heading_level:2,toc_max_heading_level:2},s="Restaurant Bot",i={unversionedId:"tutorials/restaurant",id:"tutorials/restaurant",title:"Restaurant Bot",description:"In this tutorial, you create a bot that helps users with inquiries about a fictitious restaurant called Truck Stop Gourmand.",source:"@site/docs/tutorials/restaurant.md",sourceDirName:"tutorials",slug:"/tutorials/restaurant",permalink:"/tutorials/restaurant",draft:!1,tags:[],version:"current",frontMatter:{toc_min_heading_level:2,toc_max_heading_level:2},sidebar:"docsSidebar",previous:{title:"Tutorials",permalink:"/category/tutorials"},next:{title:"Making Reservation",permalink:"/tutorials/reservation"}},l={},u=[{value:"Prerequisite",id:"prerequisite",level:3},{value:"Plan the dialog",id:"plan-the-dialog",level:2},{value:"Answer questions about the restaurant",id:"answer-questions-about-the-restaurant",level:2},{value:"Add an intent",id:"add-an-intent",level:3},{value:"Add a dialog node",id:"add-a-dialog-node",level:3},{value:"Run and test",id:"run-and-test",level:3},{value:"Answer questions about the menu",id:"answer-questions-about-the-menu",level:2},{value:"Add an intent",id:"add-an-intent-1",level:3},{value:"Add a dialog node",id:"add-a-dialog-node-1",level:3},{value:"Add phrase entity",id:"add-phrase-entity",level:3},{value:"Add followup nodes",id:"add-followup-nodes",level:3},{value:"Run and test",id:"run-and-test-1",level:3},{value:"Manage cake orders",id:"manage-cake-orders",level:2},{value:"Add regex entity",id:"add-regex-entity",level:3},{value:"Add a cancel order intent",id:"add-a-cancel-order-intent",level:3},{value:"Add a yes intent",id:"add-a-yes-intent",level:3},{value:"Handle requests to cancel a cake order",id:"handle-requests-to-cancel-a-cake-order",level:3},{value:"Ask for an order number",id:"ask-for-an-order-number",level:3},{value:"Get confirmation from the user",id:"get-confirmation-from-the-user",level:3},{value:"Run and test",id:"run-and-test-2",level:3},{value:"Add nodes to clarify order number format",id:"add-nodes-to-clarify-order-number-format",level:3},{value:"Add the personal touch",id:"add-the-personal-touch",level:2},{value:"Ask for the user&#39;s name",id:"ask-for-the-users-name",level:3},{value:"Add personalized greeting",id:"add-personalized-greeting",level:3},{value:"Run and test",id:"run-and-test-3",level:3},{value:"Conclusion",id:"conclusion",level:2}],d={toc:u};function h(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"restaurant-bot"},"Restaurant Bot"),(0,o.kt)("p",null,"In this tutorial, you create a bot that helps users with inquiries about a fictitious restaurant called Truck Stop Gourmand."),(0,o.kt)("p",null,"By the time you finish the tutorial, you will understand how to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Define intents."),(0,o.kt)("li",{parentName:"ul"},"Add dialog nodes that can handle your intents."),(0,o.kt)("li",{parentName:"ul"},"Use commands to send text and media responses."),(0,o.kt)("li",{parentName:"ul"},"Add entities to make your responses more specific."),(0,o.kt)("li",{parentName:"ul"},"Add a pattern entity, and use it in the dialog to find patterns in user input."),(0,o.kt)("li",{parentName:"ul"},"Set and reference state variables")),(0,o.kt)("p",null,"The source code of the bot is available on github: ",(0,o.kt)("a",{parentName:"p",href:"https://bitbucket.int.midvix.ai/projects/COM/repos/maxbot/browse/examples/restaurant"},"restaurant"),"."),(0,o.kt)("h3",{id:"prerequisite"},"Prerequisite"),(0,o.kt)("p",null,"Before you begin, complete the ",(0,o.kt)("a",{parentName:"p",href:"/getting-started/quick-start"},"Quick Start")," tutorial."),(0,o.kt)("p",null,"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"bot.yaml")," file that will contain the source code of the bot."),(0,o.kt)("p",null,"Add channel settings, for example, we use telegam channel:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"channels:\n  telegram:\n    api_token: 110201543:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw\n")),(0,o.kt)("h2",{id:"plan-the-dialog"},"Plan the dialog"),(0,o.kt)("p",null,"You are building a bot for a restaurant named Truck Stop Gourmand that has one location and a thriving cake-baking business. You want the simple bot to answer user questions about the restaurant, its menu, and to cancel customer cake orders. Therefore, you need to create intents that handle inquiries related to the following subjects:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Restaurant information."),(0,o.kt)("li",{parentName:"ul"},"Menu details."),(0,o.kt)("li",{parentName:"ul"},"Order cancellations.")),(0,o.kt)("p",null,"You'll start by creating intents that represent these subjects, and then build a dialog that responds to user questions about them."),(0,o.kt)("h2",{id:"answer-questions-about-the-restaurant"},"Answer questions about the restaurant"),(0,o.kt)("h3",{id:"add-an-intent"},"Add an intent"),(0,o.kt)("p",null,"Add an intent ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.about_restaurant")," that recognizes when customers ask for details about the restaurant. Provide examples of utterances that real users might enter to trigger this intent."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: about_restaurant\n  examples:\n    - Tell me about the restaurant\n    - i want to know about you\n    - who are the restaurant owners and what is their philosophy?\n    - What's your story?\n    - Where do you source your produce from?\n    - Who is your head chef and what is the chef's background?\n    - How many locations do you have?\n    - do you cater or host functions on site?\n    - Do you deliver?\n    - Are you open for breakfast?\n")),(0,o.kt)("h3",{id:"add-a-dialog-node"},"Add a dialog node"),(0,o.kt)("p",null,"Add a dialog node that recognizes when the user input maps to the intent that you created, meaning its condition checks whether your bot recognized the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.about_restaurant")," intent from the user input."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.about_restaurant\n  response:\n    - image:\n        url: https://raw.githubusercontent.com/maxbot-ai/misc/main/food_1.jpg\n    - text: >-\n          Truck Stop Gourmand is the brainchild of Gloria and Fred Smith.\n          What started out as a food truck in 2004 has expanded into a\n          thriving restaurant. We now have one brick-and-mortar restaurant\n          in downtown Portland. The bigger kitchen brought with it new chefs,\n          but each one is faithful to the philosophy that made the Smith food\n          truck so popular to begin with deliver fresh, local produce in\n          inventive and delicious ways.\n\n          Join us for lunch or dinner seven days a week. Or order a cake from\n          our bakery.\n")),(0,o.kt)("p",null,"The response consists of two commands. The ",(0,o.kt)("inlineCode",{parentName:"p"},"image")," command includes image in the response. An ",(0,o.kt)("inlineCode",{parentName:"p"},"url")," argument contains the full URL to the hosted image."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"text")," command contains a long statement about the restaurant. The folded (",(0,o.kt)("inlineCode",{parentName:"p"},">-"),") string style allows you to break long line into multiple lines for easier editing. When sent to the user, these lines will be combined into one, so your messenger can wrap words itself. To get a newline leave a blank line by putting two newlines in."),(0,o.kt)("h3",{id:"run-and-test"},"Run and test"),(0,o.kt)("p",null,"Now you can run the bot"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ maxbot run --bot bot.yaml\n\u2713 Started polling updater... Press 'Ctrl-C' to exit.\n")),(0,o.kt)("p",null,"Open your messenger and ask your bot about the restaurant. For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"Tell me about the restaurant"),"."),(0,o.kt)("p",null,"Your bot returns a response with the image and text that you specified for the dialog node. The output in your console will look like this"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"\ud83e\uddd1 Tell me about the restaurant\n\ud83e\udd16 - image:\n       url: https://raw.githubusercontent.com/maxbot-ai/misc/main/food_1.jpg\n   - text: |-\n       Truck Stop Gourmand is the brainchild of Gloria and Fred Smith. What started out as a food truck in 2004 has expanded into a thriving restaurant. We now have one brick-and-mortar restaurant in down\n       Join us for lunch or dinner seven days a week. Or order a cake from our bakery.\n")),(0,o.kt)("p",null,"Check the answer in your messenger. You will see and image and a text. With the folded string style, text that you split into lines for convenience is now merged onto a single line, except for those lines that are separated by a blank line."),(0,o.kt)("p",null,"Congratulations! You have added an intent and a dialog node that knows how to handle it."),(0,o.kt)("h2",{id:"answer-questions-about-the-menu"},"Answer questions about the menu"),(0,o.kt)("p",null,"A key question from potential restaurant customers is about the menu. The Truck Stop Gourmand restaurant changes the menu daily. In addition to its standard menu, it has vegetarian and cake shop menus. When a user asks about the menu, the dialog needs to find out which menu to share, and then provide a hyperlink to the menu that is kept up to date daily on the restaurant's website. More advanced implementation could get the menu through the restaurant website API and display it directly in the messenger."),(0,o.kt)("h3",{id:"add-an-intent-1"},"Add an intent"),(0,o.kt)("p",null,"Add the following intent with examples:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: menu\n  examples:\n    - I want to see a menu\n    - What do you have for food?\n    - Are there any specials today?\n    - where can i find out about your cuisine?\n    - What dishes do you have?\n    - What are the choices for appetizers?\n    - do you serve desserts?\n    - What is the price range of your meals?\n    - How much does a typical dish cost?\n    - tell me the entree choices\n    - Do you offer a prix fixe option?\n")),(0,o.kt)("h3",{id:"add-a-dialog-node-1"},"Add a dialog node"),(0,o.kt)("p",null,"Add a dialog node that recognizes when the user input maps to the intent that you created, meaning its condition checks whether your assistant recognized the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.menu")," intent from the user input."),(0,o.kt)("p",null,"In the bot's response we use ",(0,o.kt)("inlineCode",{parentName:"p"},"quick_reply")," command that provides a text message and a list of options for the user to choose from. In this case, the list of options includes the different versions of the menu that are available."),(0,o.kt)("p",null,"TODO: until the quick_reply command is implemented, we manage with a text message."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.menu\n  response:\n    - text: >-\n        In keeping with our commitment to giving you only fresh local ingredients,\n        our menu changes daily to accommodate the produce we pick up in the morning.\n        You can find today's menu on our website.\n\n        Which menu do you want to see? [Standard] [Vegetarian] [Cake shop]\n")),(0,o.kt)("h3",{id:"add-phrase-entity"},"Add phrase entity"),(0,o.kt)("p",null,"To recognize the different types of menus that customers indicate they want to see, you will add a ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.menu")," entity. Entities represent a class of object or a data type that is relevant to a user's purpose. By checking for the presence of specific entities in the user input, you can add more responses, each one tailored to address a distinct user request. In this case, you will add an ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.menu")," entity that can distinguish among different menu types."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"entities:\n  - name: menu\n    values:\n      - name: standard\n        phrases:\n        - standard\n        - carte du jour\n        - cuisine\n      - name: vegetarian\n        phrases:\n        - vegetarian\n        - vegan\n        - plants-only\n      - name: cake\n        phrases:\n        - cake shop\n        - dessert menu\n        - bakery offerings\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.menu")," entity contains values for three menu types: ",(0,o.kt)("inlineCode",{parentName:"p"},"standard"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"vegetarian"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"cake"),". For each value, phrases are specified by which this value is recognized."),(0,o.kt)("h3",{id:"add-followup-nodes"},"Add followup nodes"),(0,o.kt)("p",null,"In this step, you will add followup nodes to the dialog node that checks for the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.menu")," intent. Each followup node will show a different response depending on the ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.menu")," entity type the user chooses from the options list."),(0,o.kt)("p",null,"You will add a followup node to handle each menu type option that you added to the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.menu")," node."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"  - condition: intents.menu\n    label: menu\n    response:\n      - text: >-\n          # ...\n    followup:\n      - condition: entities.menu.standard\n        response: To see our menu, go to the https://www.example.com/menu.html.\n      - condition: entities.menu.vegetarian\n        response: To see our vegetarian menu, go to the https://www.example.com/vegetarian-menu.html.\n      - condition: entities.menu.cake\n        response: To see our cake shop menu, go to the https://www.example.com/cake-menu.html.\n")),(0,o.kt)("p",null,"The parent node has one more field - ",(0,o.kt)("inlineCode",{parentName:"p"},"label: menu"),". A unique label is required for all nodes with followup and slot_filling blocks. Such nodes add a new state to the dialog. The state must be distinguished from others and stored persistently. This requires a unique label."),(0,o.kt)("p",null,"The standard menu is likely to be requested most often, so you may want to move it to the end of the followup nodes list. Placing it last can help prevent it from being triggered accidentally when someone asks for a specialty menu instead the standard menu. For example, the message ",(0,o.kt)("inlineCode",{parentName:"p"},'"I am interested in vegetarian[menu:vegetarian] cuisine[menu:standard]"')," will recognize two entity values. In this case, the bot's response will depend on the order of the nodes."),(0,o.kt)("p",null,"You have added nodes that recognize user requests for menu details. Your response informs the user that there are three types of menus available, and asks them to choose one. When the user chooses a menu type, a response is displayed that provides a hypertext link to a web page with the requested menu details."),(0,o.kt)("h3",{id:"run-and-test-1"},"Run and test"),(0,o.kt)("p",null,"Test the dialog nodes that you added to recognize menu questions."),(0,o.kt)("p",null,"Run the bot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ maxbot run --bot bot.yaml\n\u2713 Started polling updater... Press 'Ctrl-C' to exit.\n")),(0,o.kt)("p",null,'Open your messenger and enter, "What do you have for food?". The bot recognizes the ',(0,o.kt)("inlineCode",{parentName:"p"},"intents.menu")," intent and displays the list of menu options for the user to choose from. In the console you will see"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 What do you have for food?\n\ud83e\udd16 In keeping with our commitment to giving you only fresh local ingredients, our menu changes daily to accommodate the produce we pick up in the morning. You can find today's menu on our website.\n   Which menu do you want to see? [Standard] [Vegetarian] [Cake shop]\n")),(0,o.kt)("p",null,'Click the "Cake shop" option. Your bot recognizes the ',(0,o.kt)("inlineCode",{parentName:"p"},"entities.menu.cake")," entity value, and displays the response"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 Cake shop\n\ud83e\udd16 To see our cake shop menu, go to the https://www.example.com/cake-menu.html.\n")),(0,o.kt)("p",null,"Well done. You have succesfully added an intent and entity that can recognize user requests for menu details, and can direct users to the appropriate menu."),(0,o.kt)("h2",{id:"manage-cake-orders"},"Manage cake orders"),(0,o.kt)("p",null,"Customers place orders in person, over the phone, or by using the order form on the website. After the order is placed, users can cancel the order through the bot. First, define an entity that can recognize order numbers. Then, add an intent that recognizes when users want to cancel a cake order."),(0,o.kt)("h3",{id:"add-regex-entity"},"Add regex entity"),(0,o.kt)("p",null,"You want the bot to recognize order numbers, so you will create a regex entity to recognize the unique format that the restaurant uses to identify its orders. The syntax of order numbers used by the restaurant's bakery is 2 uppercase letters followed by 5 numbers. For example, YR34663. Add an entity that can recognize this character pattern."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"entities:\n  - name: order_number\n    values:\n      - name: order_syntax\n        regexps:\n          - '[A-Z]{2}\\d{5}'\n")),(0,o.kt)("h3",{id:"add-a-cancel-order-intent"},"Add a cancel order intent"),(0,o.kt)("p",null,"Add an intent that recognizes when the user wants to cancel the order."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: cancel_order\n  examples:\n    - I want to cancel my cake order\n    - I need to cancel an order I just placed\n    - Can I cancel my cake order?\n    - I'd like to cancel my order\n    - There's been a change. I need to cancel my bakery order.\n    - please cancel the birthday cake order I placed last week\n    - The party theme changed; we don't need a cake anymore\n    - that order i placed, i need to cancel it.\n")),(0,o.kt)("h3",{id:"add-a-yes-intent"},"Add a yes intent"),(0,o.kt)("p",null,"Before you perform an action on the user's behalf, you must get confirmation that you are taking the proper action. Add a ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.yes")," intent to the dialog that can recognize when a user agrees with what your bot is proposing."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: "yes"\n  examples:\n    - "Yes"\n    - Correct\n    - Please do.\n    - You\'ve got it right.\n    - Please do that.\n    - that is correct.\n    - That\'s right\n    - yeah\n    - Yup\n    - Yes, I\'d like to go ahead with that.\n')),(0,o.kt)("h3",{id:"handle-requests-to-cancel-a-cake-order"},"Handle requests to cancel a cake order"),(0,o.kt)("p",null,"Add a dialog node that can handle requests to cancel a cake order."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.cancel_order\n  label: cancel_order\n  response: If the pickup time is more than 48 hours from now, you can cancel your order.\n")),(0,o.kt)("p",null,"Before you can actually cancel the order, you need to know the order number. The user might specify the order number in the original request. So, to avoid asking for the order number again, check for a number with the order number pattern in the original input."),(0,o.kt)("p",null,"Now, add followup nodes that either ask for the order number or get confirmation from the user that she wants to cancel an order with the detected order number."),(0,o.kt)("h3",{id:"ask-for-an-order-number"},"Ask for an order number"),(0,o.kt)("p",null,"Add a followup node to ask the user for the order number."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.cancel_order\n  label: cancel_order\n  response:\n    - text: If the pickup time is more than 48 hours from now, you can cancel your order.\n# highlight-start\n    - followup: {}\n  followup:\n    - condition: true\n      label: ask_order_number\n      response: What is the order number?\n# highlight-end\n")),(0,o.kt)("p",null,"The parent node's response is now modified to use two commands. The ",(0,o.kt)("inlineCode",{parentName:"p"},"text")," command displays the response, and the ",(0,o.kt)("inlineCode",{parentName:"p"},"followup")," command instructs the bot to skip waiting for user input and immediately evaluate followup nodes. An expression ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," in the followup node's condition means that the order number must always be asked for now."),(0,o.kt)("p",null,"Now go deeper. Add a couple of followup nodes to the ",(0,o.kt)("inlineCode",{parentName:"p"},"ask_order_number")," node. This nodes will process the user's response to the question about the order number:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"a node that informs the user that you are canceling the order;"),(0,o.kt)("li",{parentName:"ul"},"another node to capture the case where a user provides a number, but it is not a valid order number.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.cancel_order\n  label: cancel_order\n  response:\n    - text: If the pickup time is more than 48 hours from now, you can cancel your order.\n    - followup: {}\n  followup:\n    - condition: true\n      label: ask_order_number\n      response: What is the order number?\n# highlight-start\n      followup:\n        - condition: entities.order_number\n          response: !jinja/yaml |-\n              {% set order_number = entities.order_number.literal %}\n              - text: >-\n                  OK. The order {{ order_number }} is canceled.\n                  We hope we get the opportunity to bake a cake for you sometime soon.\n        - condition: true\n          response: >-\n              I need the order number to cancel the order for you.\n\n              If you don't know the order number, please call us\n              at 958-234-3456 to cancel over the phone.\n# highlight-end\n")),(0,o.kt)("p",null,"A node with the ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.order_number")," condition is triggererd when the user provides correct order number. This node uses template to substitute order number into the response. The use of a template is denoted by the ",(0,o.kt)("inlineCode",{parentName:"p"},"!jinja/yaml")," tag."),(0,o.kt)("p",null,"Local variables are used to store intermediate values inside templates. The order number is stored in the local variable ",(0,o.kt)("inlineCode",{parentName:"p"},"order_number")," using the ",(0,o.kt)("a",{parentName:"p",href:"design-reference/jinja#local-assignment"},"local assignment"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-django"},"{% set order_number = entities.order_number.literal %}\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.order_number.literal")," expression results in a part of the user input containing the order number. The variable is then substituted in the response to the user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-django"},"OK. The order {{ order_number }} is canceled.\n")),(0,o.kt)("p",null,"The second followup node is triggered in all other cases where the user input is not relevant to the question. In this case, we explain to the user what went wrong and offer to cancel the order by phone."),(0,o.kt)("h3",{id:"get-confirmation-from-the-user"},"Get confirmation from the user"),(0,o.kt)("p",null,"Add a followup node to the ",(0,o.kt)("inlineCode",{parentName:"p"},"cancel_order")," node that responds in the case where the user provides the order number in the initial request, so you don't have to ask for it again."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"  - condition: intents.cancel_order\n    label: cancel_order\n    response:\n      - text: If the pickup time is more than 48 hours from now, you can cancel your order.\n      - followup: {}\n    followup:\n# highlight-start\n      - condition: entities.order_number\n        label: order_number_provided\n        response: !jinja/yaml |-\n            {% slot order_number = entities.order_number.literal %}\n            - text: Just to confirm, you want to cancel order {{ slots.order_number }}?\n# highlight-end\n      - condition: true\n        label: ask_order_number\n        response: What is the order number?\n        followup:\n            # ...\n")),(0,o.kt)("p",null,"Note that the ",(0,o.kt)("inlineCode",{parentName:"p"},"order_number_provided")," node is listed first in the list of followup nodes, as its condition is more specific."),(0,o.kt)("p",null,"In the node's response, we define a slot variable ",(0,o.kt)("inlineCode",{parentName:"p"},"slots.order_number")," that stores the order number using the ",(0,o.kt)("a",{parentName:"p",href:"/design-reference/jinja#slot-assignment"},"slot assignment"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-django"},"{% slot order_number = entities.order_number.literal %}\n")),(0,o.kt)("p",null,"We use a slot variable instead of a local variable because we need its value  not only in the current template, but also in followup nodes below."),(0,o.kt)("p",null,"You must add followup nodes that check for the user's response to your confirmation question."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: entities.order_number\n  label: order_number_provided\n  response: !jinja/yaml |-\n      {% slot order_number = entities.order_number.literal %}\n      - text: Just to confirm, you want to cancel order {{ slots.order_number }}?\n# highlight-start\n  followup:\n    - condition: intents.yes\n      response: !jinja >-\n          OK. The order {{ slots.order_number }} is canceled.\n          We hope we get the opportunity to bake a cake for you sometime soon.\n    - condition: true\n      response:\n        - jump_to: {node: ask_order_number, transition: condition}\n# highlight-end\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.yes"),' node uses the slot variable we defined in the parent node to respond to the user. The "anything else" node does not send any response, instead it uses the ',(0,o.kt)("inlineCode",{parentName:"p"},"jump_to")," command to redirect users to a branch that requests the order number details you created earlier."),(0,o.kt)("h3",{id:"run-and-test-2"},"Run and test"),(0,o.kt)("p",null,"Test whether your bot can recognize character patterns that match the pattern used for product order numbers in user input."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"\ud83e\uddd1 i want to cancel my order number TW12345.\n\ud83e\udd16 If the pickup time is more than 48 hours from now, you can cancel your order.\n\ud83e\udd16 Just to confirm, you want to cancel order TW12345?\n\ud83e\uddd1 please do\n\ud83e\udd16 OK. The order TW12345 is canceled. We hope we get the opportunity to bake a cake for you sometime soon.\n")),(0,o.kt)("p",null,"Now, try it when you don't know the order number."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"\ud83e\uddd1 I want to cancel my order.\n\ud83e\udd16 If the pickup time is more than 48 hours from now, you can cancel your order.\n\ud83e\udd16 What is the order number?\n\ud83e\uddd1 I don't know.\n\ud83e\udd16 I need the order number to cancel the order for you.\n   If you don't know the order number, please call us at 958-234-3456 to cancel over the phone.\n")),(0,o.kt)("h3",{id:"add-nodes-to-clarify-order-number-format"},"Add nodes to clarify order number format"),(0,o.kt)("p",null,"If you do more testing, you might find that the dialog isn't very helpful in scenarios where the user does not remember the order number format. The user might include only the numbers or the letters too, but forget that they are meant to be uppercase. So, it would be a nice touch to give them a hint in such cases, right? If you want to be kind, add another node to the dialog tree that checks for numbers in the user input."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: true\n  label: ask_order_number\n  response: What is the order number?\n  followup:\n    - condition: entities.order_number\n      response: !jinja/yaml |-\n          {% set order_number = entities.order_number.literal %}\n          - text: >-\n              OK. The order {{ order_number }} is canceled.\n              We hope we get the opportunity to bake a cake for you sometime soon.\n# highlight-start\n    - condition: message.text|map('int')|select|list|length > 0\n      label: clarify_order_number\n      response: >-\n          The correct format for our order numbers is AAnnnnn.\n          The A's represents 2 uppercase letters, and the n's represent 5 numbers.\n\n          Do you have an order number in that format?\n# highlight-end\n    - condition: true\n      response: >-\n          # ...\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"message.text|map('int')|select|list|length > 0")," is an expression that says if you find one or more numbers in the user input, trigger this response. (TODO: need regex check like ",(0,o.kt)("inlineCode",{parentName:"p"},"message.text|find('\\d+')"),")."),(0,o.kt)("p",null,"Add followup node to the ",(0,o.kt)("inlineCode",{parentName:"p"},"clarify_order_number")," node that check for the user's reaction to your clarification."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: message.text|map('int')|select|list|length > 0\n  label: clarify_order_number\n  response: >-\n      The correct format for our order numbers is AAnnnnn.\n      The A's represents 2 uppercase letters, and the n's represent 5 numbers.\n\n      Do you have an order number in that format?\n# highlight-start\n  followup:\n    - condition: true\n      response: !jinja/yaml |-\n          {% if entities.order_number %}\n              {% set order_number = entities.order_number.literal %}\n              - text: >-\n                  OK. The order {{ order_number }} is canceled.\n                  We hope we get the opportunity to bake a cake for you sometime soon.\n          {% else %}\n              - text: >-\n                  I need the order number to cancel the order for you.\n\n                  If you don't know the order number, please call us\n                  at 958-234-3456 to cancel over the phone.\n          {% endif %}\n# highlight-end\n")),(0,o.kt)("p",null,"The node's response uses an ",(0,o.kt)("a",{parentName:"p",href:"/design-guides/templates#if-conditions"},"if-statement")," to check if bot recognizes the ",(0,o.kt)("inlineCode",{parentName:"p"},"entities.order_number"),". If so then it cancels the order, otherwise it offers to cancel the order by phone."),(0,o.kt)("p",null,"Now, when you test, you can provide a set of number or a mix of numbers and text as input, and the dialog reminds you of the correct order number format. You have successfully tested your dialog, found a weakness in it, and corrected it."),(0,o.kt)("h2",{id:"add-the-personal-touch"},"Add the personal touch"),(0,o.kt)("p",null,"If the user shows interest in the bot itself, you want the bot to recognize that curiosity and engage with the user in a more personal way. Add the ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.about_you")," intent and a node that conditions on this intent. In your response, you can ask for the user's name and save it to a ",(0,o.kt)("inlineCode",{parentName:"p"},"user.name")," user variable that you can use elsewhere in the dialog, if available."),(0,o.kt)("h3",{id:"ask-for-the-users-name"},"Ask for the user's name"),(0,o.kt)("p",null,"Add an intent ",(0,o.kt)("inlineCode",{parentName:"p"},"intents.about_you")," to recognize the user's interest in the bot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"  - name: about_you\n    examples:\n      - About you\n      - Describe yourself\n      - Do you have a name?\n      - Do you know who you are?\n      - How do I set you up?\n      - How do you work?\n      - How old are you?\n      - I want to set up a chatbot for my store\n      - Introduce yourself\n      - Let's talk about you\n      - Tell me about your life\n")),(0,o.kt)("p",null,"Add a node that handles questions about the bot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.about_you\n  label: about_you\n  response: >-\n      I am a bot that is designed to answer your questions about the\n      Truck Stop Gourmand restaurant.\n\n      What should I call you?\n  followup:\n    - condition: message.text\n      response: !jinja/yaml |-\n          {% user name = message.text %}\n          - text: >-\n              Hello, {{ user.name }}! It's lovely to meet you.\n              How can I help you today?\n")),(0,o.kt)("p",null,"An expression ",(0,o.kt)("inlineCode",{parentName:"p"},"message.text")," captures the user name as it is specified by the user. The captured name is stored in the user variable ",(0,o.kt)("inlineCode",{parentName:"p"},"user.name")," using the ",(0,o.kt)("a",{parentName:"p",href:"/design-reference/jinja#user-assignment"},"user assignment"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-django"},"{% user name = message.text %}\n")),(0,o.kt)("p",null,"Unlike slots, user variables can be used not only when discussing the current topic, but also throughout the dialog. If, at run time, the user triggers this node and provides a name, then you will know the user's name. If you know it, you should use it!"),(0,o.kt)("h3",{id:"add-personalized-greeting"},"Add personalized greeting"),(0,o.kt)("p",null,"Add an intent to recognize when the user greets the bot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"  - name: greetings\n    examples:\n      - Good morning\n      - Hello\n      - Hi\n")),(0,o.kt)("p",null,"And a dialog node to greet the user back. If you know the user's name, you should include it in your greeting message. To do so, add if-statement to your response and include a variation of the greeting that includes the user's name."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"  - condition: intents.greetings\n    response: !jinja/yaml |-\n        {% if user.name %}\n          - text: Good day to you, {{ user.name }}!\n        {% else %}\n          - text: Good day to you!\n        {% endif %}\n")),(0,o.kt)("p",null,"If slots were used to store the user's name, the bot would forget the user's name right after the ",(0,o.kt)("inlineCode",{parentName:"p"},"about_you")," dialog branch ended. But since the name is stored in a user variable, the bot will remember it throughout the dialog."),(0,o.kt)("h3",{id:"run-and-test-3"},"Run and test"),(0,o.kt)("p",null,"Test whether your assistant can recognize and save a user's name, and then refer to the user by it later."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 Who are you?\n\ud83e\udd16 I am a bot that is designed to answer your questions about the Truck Stop Gourmand restaurant.\n   What should I call you?\n\ud83e\uddd1 Jane\n\ud83e\udd16 Hello, Jane! It's lovely to meet you. How can I help you today?\n")),(0,o.kt)("p",null,"Your bot saves Jane in the ",(0,o.kt)("inlineCode",{parentName:"p"},"user.name")," variable."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83e\uddd1 Hello\n\ud83e\udd16 Good day to you, Jane!\n")),(0,o.kt)("p",null,"It uses the if-statement block that includes the user's name because the ",(0,o.kt)("inlineCode",{parentName:"p"},"user.name")," variable contains a value at the time that the greeting node is triggered."),(0,o.kt)("p",null,"You can add an if-statement that conditions on and includes the user's name for any other responses where personalization would add value to the conversation."),(0,o.kt)("h2",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"In this example, we have created a complex branching scheme that demonstrates the possibilities of the dialog tree. Another way you can address this type of scenario is to add a node with slots. See the ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/reservation"},"Reservation Bot")," tutorial to learn more about using slots."))}h.isMDXComponent=!0}}]);