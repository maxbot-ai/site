"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[940],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(n),h=r,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||i;return n?a.createElement(m,s(s({ref:t},p),{},{components:n})):a.createElement(m,s({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:r,s[1]=o;for(var u=2;u<i;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},2687:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const i={},s="Dialog State",o={unversionedId:"design-guides/state",id:"design-guides/state",title:"Dialog State",description:"State variables are used to retaining information across dialog turns. Use state variables to collect information from the user and then refer back to it later in the conversation.",source:"@site/docs/design-guides/state.md",sourceDirName:"design-guides",slug:"/design-guides/state",permalink:"/design-guides/state",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Digressions",permalink:"/design-guides/digressions"},next:{title:"Templates",permalink:"/design-guides/templates"}},l={},u=[{value:"Slot Variables",id:"slot-variables",level:2},{value:"Passing state when moving across nodes",id:"passing-state-when-moving-across-nodes",level:3},{value:"Retaining state during slot filling",id:"retaining-state-during-slot-filling",level:3},{value:"Lifespan of slot variables",id:"slots-lifespan",level:3},{value:"User Variables",id:"user-variables",level:2},{value:"Working with State Variables",id:"working-with-state-variables",level:2},{value:"Defining state variables",id:"defining-state-variables",level:3},{value:"Default values",id:"default-values",level:3},{value:"Updating state variables",id:"updating-state-variables",level:3},{value:"Deleting state variables",id:"deleting-state-variables",level:3},{value:"Capturing Values",id:"capturing-values",level:2},{value:"Capturing user input",id:"capturing-user-input",level:3},{value:"Capturing an entity mention",id:"capturing-an-entity-mention",level:3},{value:"Using a filter",id:"using-a-filter",level:3},{value:"Capturing a regexp entity literal value",id:"capturing-a-regexp-entity-literal-value",level:3}],p={toc:u};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"dialog-state"},"Dialog State"),(0,r.kt)("p",null,"State variables are used to retaining information across dialog turns. Use state variables to collect information from the user and then refer back to it later in the conversation."),(0,r.kt)("p",null,"There are two kinds of state variables."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Slot variables are used by the bot as short-term memory to keep the conversation on the current topic only."),(0,r.kt)("li",{parentName:"ul"},"User variables are long-term memory that is used to personalize the entire communication process.")),(0,r.kt)("h2",{id:"slot-variables"},"Slot Variables"),(0,r.kt)("p",null,'Slot variables only retain information during current topic discussion. When current user goal is reached, then the collected information is no longer needed, so the bot "forgets" it, the slot values are cleared. This kind of forgetfulness simplifies conversation design. If you need to store information for a long time, consider using ',(0,r.kt)("a",{parentName:"p",href:"#user-variables"},"User Variables"),"."),(0,r.kt)("h3",{id:"passing-state-when-moving-across-nodes"},"Passing state when moving across nodes"),(0,r.kt)("p",null,"Use slot variables to pass state when you ",(0,r.kt)("em",{parentName:"p"},"move from parent node to followup nodes")," or ",(0,r.kt)("em",{parentName:"p"},"jump from one node to another"),". Set slot value in a node response using the block like ",(0,r.kt)("inlineCode",{parentName:"p"},'{% slot dessert = "cake" %}'),". Get the value of a slot variable by using ",(0,r.kt)("inlineCode",{parentName:"p"},"slots")," template variable: ",(0,r.kt)("inlineCode",{parentName:"p"},"slots.dessert"),"."),(0,r.kt)("p",null,"In the example, the bot performs an order cancellation. The parent node receives the order number, stores it in a slot, and asks for confirmation from the user that he wants to cancel an order. The child node receives confirmation, reads the order number from the slot, and uses it to cancel the order."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.cancel_order and entities.order_number\n  label: cancel_order\n  response: !jinja |-\n      {% slot order_number = entities.order_number.literal %}\n      Do you want to cancel order {{ slots.order_number }}?\n  followup:\n    - condition: intents.yes\n      response: !jinja >-\n          The order {{ slots.order_number }} is canceled.\n")),(0,r.kt)("p",null,"The slot variable value (",(0,r.kt)("inlineCode",{parentName:"p"},"entities.order_number.literal"),") is an expression that captures the number that the user specifies that matches the pattern defined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"entities.order_number")," regexp entity. It saves it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"slots.order_number")," variable. After canceling the order, ",(0,r.kt)("inlineCode",{parentName:"p"},"slots.order_number")," variable is no longer needed and is cleared by the bot."),(0,r.kt)("h3",{id:"retaining-state-during-slot-filling"},"Retaining state during slot filling"),(0,r.kt)("p",null,"As the bot collects answers from the user per slot, they are saved in slot variables. You then use the slot variables in node-level response to address user goal. After the node-level response is completed and the user's goal has been reached, the slot values are cleared so that the node can start collecting information again. See ",(0,r.kt)("a",{parentName:"p",href:"/design-guides/slot-filling"},"Slot Filling")," for mode details and examples."),(0,r.kt)("h3",{id:"slots-lifespan"},"Lifespan of slot variables"),(0,r.kt)("p",null,"After the node response is completed, it depends on the bot's farther actions whether the user's current goal has been reached or whether discussion of the topic continues. The discussion continues and ",(0,r.kt)("strong",{parentName:"p"},"slots are saved")," when after executing the node response the bot needs to"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"process followup nodes;"),(0,r.kt)("li",{parentName:"ul"},"jump to another node;"),(0,r.kt)("li",{parentName:"ul"},"return after digression to the node that was interrupted.")),(0,r.kt)("p",null,"Otherwise, the goal is considered reached and the slots values are cleared."),(0,r.kt)("h2",{id:"user-variables"},"User Variables"),(0,r.kt)("p",null,"You can add user variables to retain information between different topic discussions. User variables store information for as long as necessary, unless you explicitly update or delete it."),(0,r.kt)("p",null,"User variables can pass information from one node to any other unrelated node. As the bot asks for and gets information from the user, it can keep track of the information and reference it later in the conversation. Set user variable value in a node response using the block like ",(0,r.kt)("inlineCode",{parentName:"p"},'{% user phone_number = "958-234-3456" %}'),". Get the value of a user variable by using ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," template variable: ",(0,r.kt)("inlineCode",{parentName:"p"},"{{ user.phone_number }}"),"."),(0,r.kt)("p",null,"For example, in one node you might ask users for their name, and in a later node address them by name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- condition: intents.introductions\n  label: introductions\n  response: My name is Max, the bot. What's yours?\n  followup:\n    - condition: message.text\n      response: !jinja/yaml |-\n        {% user name = message.text %}\n        - text: >-\n            It's lovely to meet you, {{ user.name }}!\n            What can I do for you?\n- condition: intents.purchase\n  response: !jinja What would you like to buy, {{ user.name }}?\n")),(0,r.kt)("p",null,"In this example, the raw user input ",(0,r.kt)("inlineCode",{parentName:"p"},"message.text")," is interpreted as a username. The ",(0,r.kt)("inlineCode",{parentName:"p"},"user.name")," variable is defined and set to the ",(0,r.kt)("inlineCode",{parentName:"p"},"message.text")," value."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\ud83e\uddd1 What do they call you?\n\ud83e\udd16 My name is Max, the bot. What's yours?\n\ud83e\uddd1 Steve\n\ud83e\udd16 It's lovely to meet you, Steve! What can I do for you?\n")),(0,r.kt)("p",null,"In a subsequent node, the ",(0,r.kt)("inlineCode",{parentName:"p"},"user.name")," variable is included in the response to address the user by name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\ud83e\uddd1 I'd like to buy something.\n\ud83e\udd16 What would you like to buy, Steve?\n")),(0,r.kt)("h2",{id:"working-with-state-variables"},"Working with State Variables"),(0,r.kt)("p",null,"You define state variables in a node. Other nodes can subsequently set or change the value of the state variable. You can condition against state variable values by referencing a slot variable from a node condition to determine whether to execute a node. You can also reference a state variable from dialog node template conditions to show different reponses depending on a value provided."),(0,r.kt)("h3",{id:"defining-state-variables"},"Defining state variables"),(0,r.kt)("p",null,"In most cases, you define the state variable as part of the node response by setting its value."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{% slot counter = 0 %}\n{% user name = "Steve" %}\n')),(0,r.kt)("p",null,"State variable name can contain any upper- and lowercase alphabetic characters, numeric characters (0-9), and underscores. The value can be any JSON-serializable type, such as strings, numbers, lists, and dicts. See ",(0,r.kt)("a",{parentName:"p",href:"/design-guides/templates#data-types"},"Templates")," guide for more information about data types."),(0,r.kt)("p",null,"You can use any ",(0,r.kt)("a",{parentName:"p",href:"/design-guides/templates#expressions"},"Jinja Expressions")," when defining state variables but make sure the resulting value will be JSON-serializable type."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'slot contains_yes = ("yes" in message.text)\n')),(0,r.kt)("h3",{id:"default-values"},"Default values"),(0,r.kt)("p",null,"When you define variable in the node response, the state variable is created and given the specified value when the bot returns the node response. Make sure state variables are defined before usage, otherwise use them with the ",(0,r.kt)("a",{parentName:"p",href:"/design-reference/jinja#filter-default"},"default filter"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"slots.counter|default(0) > 1\n")),(0,r.kt)("p",null,"or explicitly check that variable is defined:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{% if user.name %}\n  - text: What would you like to buy, {{ user.name }}?\n{% else %}\n  - text: What would you like to buy?\n{% endif %}\n")),(0,r.kt)("h3",{id:"updating-state-variables"},"Updating state variables"),(0,r.kt)("p",null,"To update a state variable's value, use the same statements, but this time, specify a different value for it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{% slot counter = slots.counter + 1 %}\n{% user name = "Bob" %}\n')),(0,r.kt)("p",null,"When more than one node sets the value of the same state variable, the value for the state variable can change over the course of a conversation with a user. Which value is applied at any given time depends on which node is being triggered by the user in the course of the conversation. The value specified for the state variable in the last node that is processed overwrites any values that were set for the variable by nodes that were processed previously."),(0,r.kt)("p",null,"TODO: example"),(0,r.kt)("h3",{id:"deleting-state-variables"},"Deleting state variables"),(0,r.kt)("p",null,"To delete a state variable, set the variable to ",(0,r.kt)("inlineCode",{parentName:"p"},"none"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{% slot counter = none %}\n{% user name = none %}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"none")," value is not stored by the bot. The variable is considered deleted and no longer uses the bot's memory. Trying to get the value of a variable will result in an error."),(0,r.kt)("p",null,"Note that slot variables automatically deleted when they out of their ",(0,r.kt)("a",{parentName:"p",href:"#slots-lifespan"},"lifespan"),"."),(0,r.kt)("h2",{id:"capturing-values"},"Capturing Values"),(0,r.kt)("p",null,"The following is examples of using Jinja expressions to capture different parts of the user input. For more information about the methods available for you to use, see ",(0,r.kt)("a",{parentName:"p",href:"/design-reference/jinja"},"Jinja Syntax")," reference."),(0,r.kt)("h3",{id:"capturing-user-input"},"Capturing user input"),(0,r.kt)("p",null,"To store the entire string that was provided by the user as input, use ",(0,r.kt)("inlineCode",{parentName:"p"},"message.text")," expression:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"slot repeat = message.text\n")),(0,r.kt)("p",null,'For example, the user input is, "I want to order a device". If the node response is'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'response: !jinja "You said: {{ slots.repeat }}."\n')),(0,r.kt)("p",null,'then the response would be displayed as, "You said: I want to order a device."'),(0,r.kt)("h3",{id:"capturing-an-entity-mention"},"Capturing an entity mention"),(0,r.kt)("p",null,"To store the value of an entity in a context variable, use this syntax"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"slot place = entities.place.value\n")),(0,r.kt)("p",null,'For example, the user input is, "I want to go to Paris". If your ',(0,r.kt)("inlineCode",{parentName:"p"},"entities.place"),' recognizes "Paris", then the bot saves "Paris" in the ',(0,r.kt)("inlineCode",{parentName:"p"},"slots.place")," variable."),(0,r.kt)("h3",{id:"using-a-filter"},"Using a filter"),(0,r.kt)("p",null,"To store the value of a string that you extract from the user's input, you can include a Jinja expression that uses the extract filter to apply a regular expression to the user input. The following expression extracts a number from the user input, and saves it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"slots.number")," variable."),(0,r.kt)("p",null,"TODO: implement this"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'slot number = message.text|extract("\\d+", 0)\n')),(0,r.kt)("h3",{id:"capturing-a-regexp-entity-literal-value"},"Capturing a regexp entity literal value"),(0,r.kt)("p",null,"To store the value of a regex entity, append ",(0,r.kt)("inlineCode",{parentName:"p"},".literal")," to the entity name. Using this syntax ensures that the exact span of text from user input that matched the specified regexp is stored in the variable."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"slot order_number = entities.order_number.literal\n")),(0,r.kt)("p",null,'For example, the user input is "Please, cancel the order AB12345". Your regexp entity ',(0,r.kt)("inlineCode",{parentName:"p"},"entities.order_number")," recognizes the '","[A-Z]","{2}\\d{5}' order number format. By configuring the slot variable to store ",(0,r.kt)("inlineCode",{parentName:"p"},"entities.order_number.literal"),", you indicate that you want to store the part of the input that matched the pattern. If you omit the ",(0,r.kt)("inlineCode",{parentName:"p"},".literal")," property from the value expression, then the entity value name that you specified for the regexp is returned instead of the segment of user input that matched the pattern."))}d.isMDXComponent=!0}}]);